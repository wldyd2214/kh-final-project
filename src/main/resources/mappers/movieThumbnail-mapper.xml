<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MovieThumbnail">
	<resultMap type="MovieThumbnail" id="movieThumbnailResultSet">
		<id property="movie_id" column="MOVIE_ID"/>
		<result property="rnum" column="RNUM"/>
		<result property="movie_title" column="MOVIE_TITLE"/>
		<result property="movie_etitle" column="MOVIE_ETITLE"/>
		<result property="movie_content" column="MOVIE_CONTENT"/>
		<result property="open_date" column="OPEN_DATE"/>
		<result property="director_name" column="DIRECTOR_NAME"/>
		<result property="production_com" column="PRODUCTION_COM"/>
		<result property="movie_age" column="MOVIE_AGE"/>
		<result property="genre" column="GENRE"/>
		<result property="runnig_time" column="RUNNIG_TIME"/>  
		<result property="file_src" column="FILE_SRC" />
		<result property="file_level" column="FILE_LEVEL" />
		<result property="mid" column="MID" />
		<result property="movie_actor" column="MOVIE_ACTOR" />
		<result property="movie_type" column="MOVIE_TYPE" />
		<result property="edit_name" column="EDIT_NAME" />
	</resultMap>
	
	<select id="getlistCount" resultType="_int">
		SELECT COUNT(*)
		FROM MOVIE M, BOARD B, BOARD_FILE BF
		WHERE M.MOVIE_ID = B.MOVIE_ID 
		 AND B.BOARD_ID = BF.BOARD_ID
		 AND BF.FILE_LEVEL='1' 
	</select>
	
	<select id="selectMovie" parameterType="MovieThumbnail" resultMap="movieThumbnailResultSet">
	SELECT M.MOVIE_ID, M.MOVIE_TITLE, M.MOVIE_ETITLE,M.OPEN_DATE,M.DIRECTOR_NAME,M.PRODUCTION_COM, 
	M.MOVIE_AGE,M.GENRE,M.RUNNIG_TIME, BF.FILE_SRC, BF.FILE_LEVEL, BF.EDIT_NAME
	FROM MOVIE M, BOARD B, BOARD_FILE BF
	WHERE M.MOVIE_ID = B.MOVIE_ID
	AND B.BOARD_ID = BF.BOARD_ID
	AND BF.FILE_LEVEL='1' 
	</select>


<select id="movieDetail" parameterType="MovieThumbnail" resultMap="movieThumbnailResultSet">

<!-- SELECT M.MOVIE_ID, M.MOVIE_TITLE, M.MOVIE_ETITLE,M.MOVIE_CONTENT, M.OPEN_DATE,M.DIRECTOR_NAME,M.PRODUCTION_COM, M.MOVIE_AGE,M.GENRE,M.RUNNIG_TIME, BF.FILE_SRC, BF.FILE_LEVEL, MOVIE_ACTOR, MOVIE_TYPE,BF.EDIT_NAMEFROM MOVIE M, BOARD B, BOARD_FILE BFWHERE M.MOVIE_ID = B.MOVIE_IDAND B.BOARD_ID = BF.BOARD_IDAND M.MOVIE_ID = #{id}AND BF.FILE_LEVEL='1' -->

SELECT RNUM, MOVIE_ID, MOVIE_TITLE, MOVIE_ETITLE, MOVIE_CONTENT, TO_CHAR(OPEN_DATE,'YYYY-MM-DD') OPEN_DATE, 
DIRECTOR_NAME,PRODUCTION_COM, MOVIE_AGE, GENRE, RUNNIG_TIME, MOVIE_ACTOR, MOVIE_TYPE,FILE_LEVEL, EDIT_NAME 
FROM(SELECT ROWNUM RNUM, MOVIE_ID, MOVIE_TITLE, MOVIE_ETITLE, MOVIE_CONTENT,OPEN_DATE, DIRECTOR_NAME,PRODUCTION_COM,
	 MOVIE_AGE, GENRE, RUNNIG_TIME, MOVIE_ACTOR,MOVIE_TYPE, FILE_LEVEL, EDIT_NAME
	 FROM(SELECT M.MOVIE_ID, M.MOVIE_TITLE, M.MOVIE_ETITLE, TO_CHAR(DBMS_LOB.SUBSTR(M.MOVIE_CONTENT, 4000))AS MOVIE_CONTENT,
	 	  M.OPEN_DATE, M.DIRECTOR_NAME, M.PRODUCTION_COM, M.MOVIE_AGE, M.GENRE, M.RUNNIG_TIME, M.MOVIE_ACTOR, M.MOVIE_TYPE, BF.FILE_LEVEL, BF.EDIT_NAME,COUNT(RE.RESERVATION_ID)
	 	  FROM MOVIE M, BOARD B, BOARD_FILE BF, PLAY PL, TURNING TU, SEAT SE, RESERVATION RE
	 	  WHERE M.MOVIE_ID = B.MOVIE_ID (+)
	 	  AND B.BOARD_ID = BF.BOARD_ID (+)
	 	  AND M.MOVIE_ID = PL.MOVIE_ID (+)
	 	  AND PL.PLAY_ID = TU.PLAY_ID (+)
	 	  AND TU.TURNING_ID = SE.TURNING_ID(+)
	 	  AND SE.SEAT_ID = RE.SEAT_ID(+)
	 	  AND BF.FILE_LEVEL='1'
	 	  group by M.MOVIE_TITLE, M.MOVIE_ID, M.MOVIE_ETITLE, M.OPEN_DATE, M.DIRECTOR_NAME, 
	 	  M.PRODUCTION_COM, M.MOVIE_AGE, M.GENRE, M.RUNNIG_TIME, BF.FILE_LEVEL, BF.EDIT_NAME, 
	 	  TO_CHAR(DBMS_LOB.SUBSTR(M.MOVIE_CONTENT, 4000)), M.MOVIE_ACTOR, M.MOVIE_TYPE 
		  ORDER BY COUNT(RE.RESERVATION_ID) DESC))
WHERE MOVIE_ID = #{id} 
<!-- SELECT RNUM, MOVIE_ID, MOVIE_TITLE, MOVIE_ETITLE,MOVIE_CONTENT, OPEN_DATE, DIRECTOR_NAME,PRODUCTION_COM,MOVIE_AGE,GENRE,RUNNIG_TIME, FILE_SRC, FILE_LEVEL, MOVIE_ACTOR, MOVIE_TYPEFROM (SELECT ROWNUM RNUM, MOVIE_ID, MOVIE_TITLE, MOVIE_ETITLE, MOVIE_CONTENT, OPEN_DATE, DIRECTOR_NAME,PRODUCTION_COM, MOVIE_AGE,GENRE,RUNNIG_TIME, FILE_SRC, FILE_LEVEL, MOVIE_ACTOR, MOVIE_TYPEFROM(SELECT M.MOVIE_ID, M.MOVIE_TITLE, M.MOVIE_ETITLE, TO_CHAR(DBMS_LOB.SUBSTR(M.MOVIE_CONTENT, 4000))AS MOVIE_CONTENT,M.OPEN_DATE, M.DIRECTOR_NAME,M.PRODUCTION_COM, M.MOVIE_AGE, M.GENRE,M.RUNNIG_TIME, BF.FILE_SRC, BF.FILE_LEVEL, M.MOVIE_ACTOR, M.MOVIE_TYPE, TU.TURNING_ID, COUNT(RE.SEAT_ID)FROM MOVIE M, BOARD B, BOARD_FILE BF, PLAY PL, TURNING TU, SEAT SE, RESERVATION REWHERE M.MOVIE_ID = B.MOVIE_ID (+)AND B.BOARD_ID = BF.BOARD_ID(+)AND M.MOVIE_ID = PL.MOVIE_ID(+)AND PL.PLAY_ID = TU.PLAY_ID(+)AND TU.TURNING_ID = SE.TURNING_ID(+)AND SE.SEAT_ID = RE.SEAT_ID(+)AND BF.FILE_LEVEL='1'GROUP BY M.MOVIE_ID, M.MOVIE_TITLE, M.MOVIE_ETITLE, TO_CHAR(DBMS_LOB.SUBSTR(M.MOVIE_CONTENT, 4000)),M.OPEN_DATE,M.DIRECTOR_NAME, M.PRODUCTION_COM, M.MOVIE_AGE, M.GENRE, M.RUNNIG_TIME,BF.FILE_SRC, BF.FILE_LEVEL, M.MOVIE_ACTOR, M.MOVIE_TYPE,TU.TURNING_IDORDER BY COUNT(RE.SEAT_ID) DESC)) WHERE MOVIE_ID = #{id} -->

</select>

<select id="movieImageCut" parameterType="MovieThumbnail" resultMap="movieThumbnailResultSet">
SELECT M.MOVIE_ID, M.MOVIE_TITLE, M.MOVIE_ETITLE,M.MOVIE_CONTENT, M.OPEN_DATE,M.DIRECTOR_NAME,M.PRODUCTION_COM,
 M.MOVIE_AGE,M.GENRE,M.RUNNIG_TIME, BF.FILE_SRC, BF.FILE_LEVEL, BF.EDIT_NAME
 FROM MOVIE M, BOARD B, BOARD_FILE BF
 WHERE M.MOVIE_ID = B.MOVIE_ID
 AND B.BOARD_ID = BF.BOARD_ID
 AND M.MOVIE_ID = #{id}
 AND BF.FILE_LEVEL = '2'
  </select>

<select id="movieVideo" parameterType="MovieThumbnail" resultMap="movieThumbnailResultSet">
SELECT M.MOVIE_ID, M.MOVIE_TITLE, M.MOVIE_ETITLE,M.MOVIE_CONTENT, M.OPEN_DATE,M.DIRECTOR_NAME,
M.PRODUCTION_COM, M.MOVIE_AGE,M.GENRE,M.RUNNIG_TIME, BF.FILE_SRC, BF.FILE_LEVEL, BF.EDIT_NAME
FROM MOVIE M, BOARD B, BOARD_FILE BF
WHERE M.MOVIE_ID = B.MOVIE_ID
AND B.BOARD_ID = BF.BOARD_ID
AND M.MOVIE_ID = #{id}
AND BF.FILE_LEVEL = '3'
 </select>

<select id="selectMovieRank1" parameterType="MovieThumbnail" resultMap="movieThumbnailResultSet">
SELECT RNUM, MOVIE_ID, MOVIE_TITLE, MOVIE_ETITLE, OPEN_DATE, DIRECTOR_NAME,PRODUCTION_COM, MOVIE_AGE, GENRE, 
    RUNNIG_TIME, FILE_LEVEL, EDIT_NAME 
FROM(SELECT ROWNUM RNUM, MOVIE_ID, MOVIE_TITLE, MOVIE_ETITLE, OPEN_DATE, DIRECTOR_NAME,PRODUCTION_COM, MOVIE_AGE, GENRE, 
    RUNNIG_TIME, FILE_LEVEL, EDIT_NAME 
    FROM(SELECT M.MOVIE_ID, M.MOVIE_TITLE, M.MOVIE_ETITLE, M.OPEN_DATE, M.DIRECTOR_NAME,M.PRODUCTION_COM, 
         M.MOVIE_AGE, M.GENRE, M.RUNNIG_TIME, BF.FILE_LEVEL, BF.EDIT_NAME,COUNT(RE.RESERVATION_ID)
         FROM MOVIE M, BOARD B, BOARD_FILE BF, PLAY PL, TURNING TU, SEAT SE, RESERVATION RE
         WHERE M.MOVIE_ID = B.MOVIE_ID (+)
         AND B.BOARD_ID = BF.BOARD_ID (+)
         AND M.MOVIE_ID = PL.MOVIE_ID (+)
         AND PL.PLAY_ID = TU.PLAY_ID (+)
         AND TU.TURNING_ID = SE.TURNING_ID(+)
         AND SE.SEAT_ID = RE.SEAT_ID(+)
         AND BF.FILE_LEVEL='1'
         group by M.MOVIE_TITLE, M.MOVIE_ID, M.MOVIE_ETITLE, M.OPEN_DATE, M.DIRECTOR_NAME, M.PRODUCTION_COM, 
         M.MOVIE_AGE, M.GENRE, M.RUNNIG_TIME, BF.FILE_LEVEL, BF.EDIT_NAME 
         ORDER BY COUNT(RE.RESERVATION_ID) DESC))
WHERE RNUM BETWEEN 1 AND 3
</select>

<select id="selectMovieRank2" parameterType="MovieThumbnail" resultMap="movieThumbnailResultSet"> 
SELECT RNUM, MOVIE_ID, MOVIE_TITLE, MOVIE_ETITLE, OPEN_DATE, DIRECTOR_NAME,PRODUCTION_COM, MOVIE_AGE, GENRE, 
    RUNNIG_TIME, FILE_LEVEL, EDIT_NAME 
FROM(SELECT ROWNUM RNUM, MOVIE_ID, MOVIE_TITLE, MOVIE_ETITLE, OPEN_DATE, DIRECTOR_NAME,PRODUCTION_COM, MOVIE_AGE, GENRE, 
    RUNNIG_TIME, FILE_LEVEL, EDIT_NAME 
    FROM(SELECT M.MOVIE_ID, M.MOVIE_TITLE, M.MOVIE_ETITLE, M.OPEN_DATE, M.DIRECTOR_NAME,M.PRODUCTION_COM, 
         M.MOVIE_AGE, M.GENRE, M.RUNNIG_TIME, BF.FILE_LEVEL, BF.EDIT_NAME,COUNT(RE.RESERVATION_ID)
         FROM MOVIE M, BOARD B, BOARD_FILE BF, PLAY PL, TURNING TU, SEAT SE, RESERVATION RE
         WHERE M.MOVIE_ID = B.MOVIE_ID (+)
         AND B.BOARD_ID = BF.BOARD_ID (+)
         AND M.MOVIE_ID = PL.MOVIE_ID (+)
         AND PL.PLAY_ID = TU.PLAY_ID (+)
         AND TU.TURNING_ID = SE.TURNING_ID(+)
         AND SE.SEAT_ID = RE.SEAT_ID(+)
         AND BF.FILE_LEVEL='1'
         group by M.MOVIE_TITLE, M.MOVIE_ID, M.MOVIE_ETITLE, M.OPEN_DATE, M.DIRECTOR_NAME, M.PRODUCTION_COM, 
         M.MOVIE_AGE, M.GENRE, M.RUNNIG_TIME, BF.FILE_LEVEL, BF.EDIT_NAME 
         ORDER BY COUNT(RE.RESERVATION_ID) DESC))
WHERE RNUM BETWEEN 4 AND 6 
</select>

<select id="selectMovieRank3" parameterType="MovieThumbnail" resultMap="movieThumbnailResultSet"> 
SELECT RNUM, MOVIE_ID, MOVIE_TITLE, MOVIE_ETITLE, OPEN_DATE, DIRECTOR_NAME,PRODUCTION_COM, MOVIE_AGE, GENRE, 
    RUNNIG_TIME, FILE_LEVEL, EDIT_NAME 
FROM(SELECT ROWNUM RNUM, MOVIE_ID, MOVIE_TITLE, MOVIE_ETITLE, OPEN_DATE, DIRECTOR_NAME,PRODUCTION_COM, MOVIE_AGE, GENRE, 
    RUNNIG_TIME, FILE_LEVEL, EDIT_NAME 
    FROM(SELECT M.MOVIE_ID, M.MOVIE_TITLE, M.MOVIE_ETITLE, M.OPEN_DATE, M.DIRECTOR_NAME,M.PRODUCTION_COM, 
         M.MOVIE_AGE, M.GENRE, M.RUNNIG_TIME, BF.FILE_LEVEL, BF.EDIT_NAME,COUNT(RE.RESERVATION_ID)
         FROM MOVIE M, BOARD B, BOARD_FILE BF, PLAY PL, TURNING TU, SEAT SE, RESERVATION RE
         WHERE M.MOVIE_ID = B.MOVIE_ID (+)
         AND B.BOARD_ID = BF.BOARD_ID (+)
         AND M.MOVIE_ID = PL.MOVIE_ID (+)
         AND PL.PLAY_ID = TU.PLAY_ID (+)
         AND TU.TURNING_ID = SE.TURNING_ID(+)
         AND SE.SEAT_ID = RE.SEAT_ID(+)
         AND BF.FILE_LEVEL='1'
         group by M.MOVIE_TITLE, M.MOVIE_ID, M.MOVIE_ETITLE, M.OPEN_DATE, M.DIRECTOR_NAME, M.PRODUCTION_COM, 
         M.MOVIE_AGE, M.GENRE, M.RUNNIG_TIME, BF.FILE_LEVEL, BF.EDIT_NAME 
         ORDER BY COUNT(RE.RESERVATION_ID) DESC))
WHERE RNUM BETWEEN 7 AND 9 
</select>

<!-- 위시리스트 뷰 뿌리기용 쿼리문 -->


<select id="selectWishlist" parameterType="MovieThumbnail" resultMap="movieThumbnailResultSet">
SELECT M.MOVIE_ID, M.MOVIE_TITLE, M.MOVIE_ETITLE,M.MOVIE_CONTENT, M.OPEN_DATE,M.DIRECTOR_NAME,M.PRODUCTION_COM, M.MOVIE_AGE,M.GENRE,M.RUNNIG_TIME, BF.EDIT_NAME, BF.FILE_SRC, BF.FILE_LEVEL
FROM MOVIE M, BOARD B, BOARD_FILE BF, WISHLIST W
WHERE M.MOVIE_ID = B.MOVIE_ID
AND B.BOARD_ID = BF.BOARD_ID
AND W.MOVIE_ID = M.MOVIE_ID
AND BF.FILE_LEVEL='1'
AND W.MID = '${mid}' </select>

<!-- 위시리스트 중복 조회용 쿼리문 -->


<select id="checkDupli" resultType="java.lang.Integer" parameterType="Movie">
SELECT NVL(COUNT(*),0)
FROM WISHLIST
WHERE MID = #{ mid }
AND MOVIE_ID = #{ movie_id } </select>

<select id="movieSelectOne" parameterType="MovieThumbnail" resultMap="movieThumbnailResultSet">
SELECT MOVIE_ID, MOVIE_TITLE, MOVIE_ETITLE,MOVIE_CONTENT, OPEN_DATE,DIRECTOR_NAME,
PRODUCTION_COM, MOVIE_AGE,GENRE,RUNNIG_TIME, MOVIE_ACTOR, MOVIE_TYPE
FROM MOVIE
WHERE MOVIE_TITLE = #{id} </select>

<insert id="insertMovie">
INSERT INTO MOVIE VALUES('MO' || TO_CHAR(MOVIE_MOVIE_ID.NEXTVAL), #{movie_title}, #{movie_etitle}, #{movie_content}, #{open_date} , #{director_name}, #{production_com}, #{movie_age}, #{genre}, #{runnig_time}, #{movie_actor}, #{movie_type}) </insert>
	
</mapper>